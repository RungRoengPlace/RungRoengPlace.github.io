import{c as H,r as c,b as x,j as e,a as j,S as n}from"./index-DwUU5yaf.js";import{M as u}from"./types-CcqlWfqW.js";import{P as y,T as A}from"./trash-B5tv9Mf5.js";import{P as _,S as C,f as R}from"./format-Bw6PelTg.js";import{X}from"./x-Dtd4ebc7.js";const Y=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],S=H("layers",Y),V=()=>{const[b,P]=c.useState(null),[k,p]=c.useState([]),[D,M]=c.useState(!0),g={date:new Date().toISOString().split("T")[0],type:"ค่าส่วนกลาง",month:u[new Date().getMonth()],houseNo:"",name:"",amount:500,note:"-"},[l,r]=c.useState(g),[d,N]=c.useState(!1),[I,f]=c.useState(!1),[s,h]=c.useState({houseNo:"",name:"",year:new Date().getFullYear(),selectedMonths:[],amountPerMonth:0,date:new Date().toISOString().split("T")[0],note:"ชำระค่าส่วนกลางล่วงหน้า"});c.useEffect(()=>{z()},[]);const z=async()=>{M(!0);const[t,a]=await Promise.all([x.getDropdownData(),x.getIncomes(50)]);P(t),p(a),t.members.length>0&&l.houseNo,M(!1)},L=t=>{const a=t.target.value,o=b?.members.find(i=>i.houseNo===a);r({...l,houseNo:a,name:o?o.name:"",amount:o?o.commonFee:0})},T=async t=>{if(t.preventDefault(),!l.houseNo||!l.amount){n.fire("ข้อมูลไม่ครบถ้วน","กรุณาระบุบ้านเลขที่และจำนวนเงิน","warning");return}n.showLoading();try{await x.saveIncome(l),n.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),d?(r(g),N(!1)):r(o=>({...g,date:o.date,month:o.month}));const a=await x.getIncomes(50);p(a)}catch{n.fire("Error","เกิดข้อผิดพลาดในการบันทึก","error")}},F=t=>{r(t),N(!0),window.scrollTo({top:0,behavior:"smooth"})},B=async t=>{if(!t)return;if((await n.fire({title:"ยืนยันการลบ?",text:"ข้อมูลนี้จะถูกลบถาวร",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"ลบข้อมูล",cancelButtonText:"ยกเลิก"})).isConfirmed){n.showLoading(),await x.deleteIncome(t),n.close();const o=await x.getIncomes(50);p(o)}},E=t=>{const a=t.target.value,o=b?.members.find(i=>i.houseNo===a);h(i=>({...i,houseNo:a,name:o?o.name:"",amountPerMonth:o?o.commonFee:0}))},$=t=>{h(a=>{const o=a.selectedMonths.includes(t);return{...a,selectedMonths:o?a.selectedMonths.filter(i=>i!==t):[...a.selectedMonths,t]}})},q=async t=>{if(t.preventDefault(),!s.houseNo||s.selectedMonths.length===0){n.fire("ข้อมูลไม่ครบ","กรุณาเลือกบ้านเลขที่และอย่างน้อย 1 เดือน","warning");return}const a=s.selectedMonths.length*s.amountPerMonth;if((await n.fire({title:"ยืนยันการบันทึก?",html:`บ้านเลขที่: <b>${s.houseNo}</b><br/>จำนวน: <b>${s.selectedMonths.length} เดือน</b><br/>รวมเป็นเงิน: <b>${a.toLocaleString()} บาท</b>`,icon:"question",showCancelButton:!0,confirmButtonText:"ยืนยันการชำระ",cancelButtonText:"ยกเลิก"})).isConfirmed){const i=[...s.selectedMonths].sort((m,v)=>u.indexOf(m)-u.indexOf(v));let w=0;for(const m of i){n.update({title:"กำลังบันทึก...",html:`เดือน: <b>${m}</b> (${w+1}/${i.length})`}),n.showLoading();const v={date:s.date,type:"ค่าส่วนกลาง",month:m,houseNo:s.houseNo,name:s.name,amount:s.amountPerMonth,note:s.note};await x.saveIncome(v),w++}n.fire("สำเร็จ",`บันทึกข้อมูลเรียบร้อย ${w} รายการ`,"success"),f(!1),h(m=>({...m,houseNo:"",name:"",selectedMonths:[]}));const O=await x.getIncomes(50);p(O)}};return D?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"กำลังโหลดข้อมูล..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:j("bg-white p-6 rounded-2xl shadow-lg border transition-colors",d?"border-amber-200 bg-amber-50/10":"border-teal-100"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center",children:[e.jsx("div",{className:j("p-2 rounded-lg mr-3 shadow-sm",d?"bg-amber-100 text-amber-600":"bg-teal-100 text-teal-600"),children:d?e.jsx(y,{size:20}):e.jsx(_,{size:20})}),d?"แก้ไขรายการรับ":"บันทึกรายรับใหม่"]}),d&&e.jsx("button",{onClick:()=>{N(!1),r(g)},className:"text-sm text-red-500 hover:text-red-700 font-medium px-3 py-1 rounded-lg hover:bg-red-50",children:"ยกเลิกการแก้ไข"}),!d&&e.jsxs("button",{onClick:()=>f(!0),className:"ml-auto text-sm bg-indigo-50 text-indigo-600 hover:bg-indigo-100 font-bold px-4 py-2 rounded-xl border border-indigo-200 flex items-center shadow-sm transition-transform active:scale-95",children:[e.jsx(S,{size:18,className:"mr-2"}),"ชำระหลายเดือน"]})]}),e.jsxs("form",{onSubmit:T,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"วันที่"}),e.jsx("input",{type:"date",value:l.date,onChange:t=>r({...l,date:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none transition-shadow",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"ประจำเดือน"}),e.jsx("select",{value:l.month,onChange:t=>r({...l,month:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none transition-shadow",children:u.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"ประเภท"}),e.jsx("select",{value:l.type,onChange:t=>r({...l,type:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none transition-shadow",children:b?.incomeTypes.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"บ้านเลขที่"}),e.jsxs("select",{value:l.houseNo,onChange:L,className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none transition-shadow",required:!0,children:[e.jsx("option",{value:"",children:"-- เลือก --"}),b?.members.map(t=>e.jsxs("option",{value:t.houseNo,children:[t.houseNo," (",t.name,")"]},t.houseNo))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"ชื่อ-สกุล"}),e.jsx("input",{type:"text",value:l.name,readOnly:!0,className:"w-full border-slate-200 rounded-xl p-3 bg-slate-100 text-slate-500 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"จำนวนเงิน"}),e.jsx("input",{type:"number",step:"0.01",value:l.amount,onChange:t=>r({...l,amount:Number(t.target.value)}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none text-right font-mono font-bold text-lg text-teal-700",required:!0,min:"0"})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"หมายเหตุ"}),e.jsx("input",{type:"text",value:l.note,onChange:t=>r({...l,note:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-teal-500 outline-none transition-shadow",placeholder:"-"})]}),e.jsx("div",{className:"lg:col-span-4 flex justify-end mt-4",children:e.jsx("button",{type:"submit",className:j("flex items-center space-x-2 px-8 py-3 rounded-xl font-bold shadow-lg transition-all transform hover:scale-105 active:scale-95",d?"bg-amber-500 hover:bg-amber-600 text-white shadow-amber-200":"bg-teal-600 hover:bg-teal-700 text-white shadow-teal-200"),children:d?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:18}),e.jsx("span",{children:"อัปเดตข้อมูล"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:18}),e.jsx("span",{children:"บันทึกรายรับ"})]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-100 font-bold text-slate-600 flex justify-between items-center",children:[e.jsx("span",{children:"ประวัติรายการล่าสุด"}),e.jsx("span",{className:"text-xs font-normal text-slate-400",children:"แสดง 50 รายการล่าสุด"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 uppercase font-bold text-xs sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"วันที่"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"บ้านเลขที่"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"ประเภท"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"ประจำเดือน"}),e.jsx("th",{className:"px-6 py-3 text-right whitespace-nowrap",children:"จำนวนเงิน"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"หมายเหตุ"}),e.jsx("th",{className:"px-6 py-3 text-center whitespace-nowrap",children:"จัดการ"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-slate-400",children:"ไม่พบข้อมูลบันทึกรายรับ"})}):k.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-slate-600 font-mono text-xs",children:R(new Date(t.date),"dd/MM/yyyy")}),e.jsxs("td",{className:"px-6 py-4 font-medium text-slate-700",children:[t.houseNo," ",e.jsx("span",{className:"text-xs text-slate-400 block",children:t.name})]}),e.jsx("td",{className:"px-6 py-4 text-slate-600 whitespace-nowrap",children:t.type}),e.jsx("td",{className:"px-6 py-4 text-slate-600 whitespace-nowrap",children:t.month}),e.jsx("td",{className:"px-6 py-4 text-right font-bold text-teal-600 font-mono",children:t.amount.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-slate-500 max-w-xs truncate",children:t.note}),e.jsxs("td",{className:"px-6 py-4 flex justify-center space-x-3 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>F(t),className:"text-amber-400 hover:text-amber-600 p-1 hover:bg-amber-50 rounded",children:e.jsx(y,{size:16})}),e.jsx("button",{onClick:()=>B(t.rowIndex),className:"text-red-400 hover:text-red-600 p-1 hover:bg-red-50 rounded",children:e.jsx(A,{size:16})})]})]},t.rowIndex))})]})})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-start justify-center z-50 p-4 pt-10 animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 flex justify-between items-center bg-indigo-50/50",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 flex items-center",children:[e.jsx(S,{className:"mr-2 text-indigo-600"})," ชำระค่าส่วนกลางแบบเหมาจ่าย"]}),e.jsx("p",{className:"text-sm text-slate-500",children:"บันทึกรับเงินล่วงหน้าหลายเดือนในครั้งเดียว"})]}),e.jsx("button",{onClick:()=>f(!1),className:"text-slate-400 hover:text-red-500 transition-colors bg-white p-2 rounded-full shadow-sm",children:e.jsx(X,{size:24})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"บ้านเลขที่"}),e.jsxs("select",{value:s.houseNo,onChange:E,className:"w-full border-slate-200 rounded-xl p-3 bg-white focus:ring-2 focus:ring-indigo-500 outline-none text-slate-700 font-medium",children:[e.jsx("option",{value:"",children:"-- เลือกบ้านเลขที่ --"}),b?.members.map(t=>e.jsxs("option",{value:t.houseNo,children:[t.houseNo," (",t.name,")"]},t.houseNo))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"วันที่ชำระเงิน"}),e.jsx("input",{type:"date",value:s.date,onChange:t=>h({...s,date:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-white focus:ring-2 focus:ring-indigo-500 outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"ชื่อสมาชิก"}),e.jsx("div",{className:"p-3 bg-slate-50 rounded-xl border border-slate-200 text-slate-700",children:s.name||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"ค่าส่วนกลาง/เดือน"}),e.jsx("div",{className:"p-3 bg-indigo-50 rounded-xl border border-indigo-100 text-indigo-700 font-bold text-right font-mono",children:s.amountPerMonth.toLocaleString()})]})]}),e.jsx("hr",{className:"border-slate-100"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-3",children:[e.jsxs("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider",children:["เลือกเดือนที่ชำระ (ปี ",s.year+543,")"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>h(t=>({...t,selectedMonths:[...u]})),className:"text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-2 py-1 rounded",children:"เลือกทั้งหมด"}),e.jsx("button",{type:"button",onClick:()=>h(t=>({...t,selectedMonths:[]})),className:"text-xs bg-slate-100 hover:bg-red-50 text-slate-600 hover:text-red-500 px-2 py-1 rounded",children:"ล้าง"})]})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3",children:u.map(t=>{const a=s.selectedMonths.includes(t);return e.jsxs("button",{type:"button",onClick:()=>$(t),className:j("p-3 rounded-xl border text-sm font-bold transition-all duration-200 flex flex-col items-center justify-center space-y-1 relative overflow-hidden",a?"bg-indigo-600 border-indigo-600 text-white shadow-md shadow-indigo-200 transform scale-105":"bg-white border-slate-200 text-slate-500 hover:border-indigo-300 hover:bg-slate-50"),children:[e.jsx("span",{children:t}),a&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]},t)})})]}),e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"หมายเหตุ"}),e.jsx("input",{type:"text",value:s.note,onChange:t=>h({...s,note:t.target.value}),className:"w-full border-slate-200 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 outline-none text-sm"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-200",children:[e.jsxs("span",{className:"text-slate-600 font-medium",children:["จำนวนเดือนที่เลือก: ",e.jsx("span",{className:"text-indigo-600 font-bold",children:s.selectedMonths.length})," เดือน"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-slate-500 mr-2",children:"รวมเป็นเงินทั้งสิ้น"}),e.jsx("span",{className:"text-2xl font-bold text-indigo-700",children:(s.selectedMonths.length*s.amountPerMonth).toLocaleString()}),e.jsx("span",{className:"text-xs text-slate-500 ml-1",children:"บาท"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border-t border-slate-200 flex justify-end space-x-3 rounded-b-2xl",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-200 hover:text-slate-700 transition-colors",children:"ยกเลิก"}),e.jsxs("button",{onClick:q,disabled:s.selectedMonths.length===0||!s.houseNo,className:"px-8 py-3 rounded-xl font-bold bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[e.jsx(C,{size:18,className:"mr-2"}),"ยืนยันการบันทึก"]})]})]})})]})};export{V as Income};
