import{r as l,b as i,S as r,j as e,a as c}from"./index-BLdxFrRq.js";import{P as u,T as N}from"./trash-Bcp4THCP.js";import{P as k,S,f as B}from"./format-cITwwtcr.js";const M=()=>{const[m,d]=l.useState([]),[g,b]=l.useState(!0),x={date:new Date().toISOString().split("T")[0],account:"บัญชีรอง",type:"ฝาก",amount:0,note:"-"},[s,a]=l.useState(x),[n,h]=l.useState(!1);l.useEffect(()=>{f()},[]);const f=async()=>{b(!0);try{const t=await i.getBookBankMovements(50);Array.isArray(t)?d(t):(console.error("Invalid data received:",t),t?.error==="Unknown action"?r.fire("Connection Error","กรุณาอัปเดต Google Apps Script (Deploy New Version) เพื่อรองรับฟีเจอร์ใหม่","error"):d([]))}catch(t){console.error(t),r.fire("Error","ไม่สามารถโหลดข้อมูลได้","error")}b(!1)},j=async t=>{if(t.preventDefault(),!s.amount||s.amount<=0){r.fire("ข้อมูลไม่ครบถ้วน","กรุณาระบุจำนวนเงินที่มากกว่า 0","warning");return}r.showLoading();try{const o=await i.saveBookBankMovement(s);if(o&&o.error)throw new Error(o.error);r.fire({icon:"success",title:"บันทึกสำเร็จ",timer:1500,showConfirmButton:!1}),n?(a(x),h(!1)):a(y=>({...x,date:y.date}));const p=await i.getBookBankMovements(50);d(p)}catch(o){console.error(o),r.fire("Error",o.message||"เกิดข้อผิดพลาดในการบันทึก","error")}},w=t=>{a(t),h(!0),window.scrollTo({top:0,behavior:"smooth"})},v=async t=>{if(!t)return;if((await r.fire({title:"ยืนยันการลบ?",text:"ข้อมูลนี้จะถูกลบถาวร",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"})).isConfirmed){r.showLoading(),await i.deleteBookBankMovement(t),r.close();const p=await i.getBookBankMovements(50);d(p)}};return g?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"กำลังโหลดข้อมูล..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:c("bg-white p-6 rounded-2xl shadow-lg border transition-colors",n?"border-amber-200 bg-amber-50/10":"border-blue-100"),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-800 flex items-center",children:[e.jsx("div",{className:c("p-2 rounded-lg mr-3 shadow-sm",n?"bg-amber-100 text-amber-600":"bg-blue-100 text-blue-600"),children:n?e.jsx(u,{size:20}):e.jsx(k,{size:20})}),n?"แก้ไขรายการ":"บันทึกยอดเงินในบัญชี"]}),n&&e.jsx("button",{onClick:()=>{h(!1),a(x)},className:"text-sm text-red-500 hover:text-red-700 font-medium px-3 py-1 rounded-lg hover:bg-red-50",children:"ยกเลิกการแก้ไข"})]}),e.jsxs("form",{onSubmit:j,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"วันที่"}),e.jsx("input",{type:"date",value:s.date,onChange:t=>a({...s,date:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-shadow",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"บัญชี"}),e.jsxs("select",{value:s.account,onChange:t=>a({...s,account:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-shadow",children:[e.jsx("option",{value:"บัญชีหลัก",children:"บัญชีหลัก"}),e.jsx("option",{value:"บัญชีรอง",children:"บัญชีรอง"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"รายการ"}),e.jsxs("select",{value:s.type,onChange:t=>a({...s,type:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-shadow",children:[e.jsx("option",{value:"ฝาก",children:"ฝาก (Deposit)"}),e.jsx("option",{value:"ถอน",children:"ถอน (Withdraw)"})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"จำนวนเงิน"}),e.jsx("input",{type:"number",step:"0.01",value:s.amount,onChange:t=>a({...s,amount:Number(t.target.value)}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none text-right font-mono font-bold text-lg text-blue-700",required:!0,min:"0"})]}),e.jsxs("div",{className:"lg:col-span-5",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"หมายเหตุ"}),e.jsx("input",{type:"text",value:s.note,onChange:t=>a({...s,note:t.target.value}),className:"w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none transition-shadow",placeholder:"-"})]}),e.jsx("div",{className:"lg:col-span-5 flex justify-end mt-4",children:e.jsx("button",{type:"submit",className:c("flex items-center space-x-2 px-8 py-3 rounded-xl font-bold shadow-lg transition-all transform hover:scale-105 active:scale-95",n?"bg-amber-500 hover:bg-amber-600 text-white shadow-amber-200":"bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200"),children:n?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18}),e.jsx("span",{children:"อัปเดตข้อมูล"})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:18}),e.jsx("span",{children:"บันทึกรายการ"})]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-50 border-b border-slate-100 font-bold text-slate-600 flex justify-between items-center",children:[e.jsx("span",{children:"ประวัติบัญชีล่าสุด"}),e.jsx("span",{className:"text-xs font-normal text-slate-400",children:"แสดง 50 รายการล่าสุด"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 uppercase font-bold text-xs sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"วันที่"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"บัญชี"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"รายการ"}),e.jsx("th",{className:"px-6 py-3 text-right whitespace-nowrap",children:"จำนวนเงิน"}),e.jsx("th",{className:"px-6 py-3 whitespace-nowrap",children:"หมายเหตุ"}),e.jsx("th",{className:"px-6 py-3 text-center whitespace-nowrap",children:"จัดการ"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-slate-400",children:"ไม่พบข้อมูล"})}):m.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-slate-600 font-mono text-xs",children:B(new Date(t.date),"dd/MM/yyyy")}),e.jsx("td",{className:"px-6 py-4 font-medium text-slate-700",children:t.account}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:c("px-2 py-1 rounded text-xs font-bold",t.type==="ฝาก"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:t.type})}),e.jsx("td",{className:c("px-6 py-4 text-right font-bold font-mono",t.type==="ฝาก"?"text-green-600":"text-red-600"),children:t.amount.toLocaleString()}),e.jsx("td",{className:"px-6 py-4 text-slate-500 max-w-xs truncate",children:t.note}),e.jsxs("td",{className:"px-6 py-4 flex justify-center space-x-3 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>w(t),className:"text-amber-400 hover:text-amber-600 p-1 hover:bg-amber-50 rounded",children:e.jsx(u,{size:16})}),e.jsx("button",{onClick:()=>v(t.rowIndex),className:"text-red-400 hover:text-red-600 p-1 hover:bg-red-50 rounded",children:e.jsx(N,{size:16})})]})]},t.rowIndex))})]})})]})]})};export{M as BookBank};
